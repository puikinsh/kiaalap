{{> head}}

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .auth-container {
            width: 100%;
            max-width: 420px;
            padding: 20px;
        }
        .auth-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .brand-logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: #6366f1;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .brand-logo i {
            font-size: 30px;
            color: white;
        }
        .success-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: #10b981;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .success-icon i {
            font-size: 30px;
            color: white;
        }
</style>

{{> sidebar}}

<!-- Main Content Wrapper -->
<div class="main-wrapper" id="mainWrapper">
    {{> header}}

    <!-- Main Content -->
    <main class="dashboard-content" id="main-content">
        <div class="container-fluid">
<!-- Initial Password Recovery Form -->
        <div class="auth-card" id="recoveryForm">
            <div class="auth-header">
                <div class="brand-logo">
                    <i class="bi bi-key"></i>
                </div>
                <h1 class="h3 mb-2 fw-bold">Forgot Password?</h1>
                <p class="text-muted">No worries! Enter your email and we'll send you reset instructions.</p>
            </div>

            <form id="passwordRecoveryForm" novalidate>
                <div class="mb-4">
                    <label for="email" class="form-label">Email Address</label>
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="bi bi-envelope"></i>
                        </span>
                        <input type="email"
                               class="form-control"
                               id="email"
                               name="email"
                               placeholder="example@kiaalap.edu"
                               required
                               autofocus
                               aria-label="Email Address"
                               aria-describedby="emailHelp">
                    </div>
                    <div class="invalid-feedback">
                        Please enter a valid email address.
                    </div>
                    <small id="emailHelp" class="form-text text-muted">
                        Enter the email address associated with your account.
                    </small>
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-primary btn-lg" type="submit">
                        <i class="bi bi-send me-2"></i>
                        Send Reset Instructions
                    </button>
                </div>

                <hr class="my-4">

                <div class="text-center">
                    <p class="mb-2">
                        <a href="login.html" class="text-decoration-none">
                            <i class="bi bi-arrow-left me-1"></i>
                            Back to Login
                        </a>
                    </p>
                    <p>
                        Don't have an account?
                        <a href="register.html" class="text-decoration-none fw-bold">
                            Sign up
                        </a>
                    </p>
                </div>
            </form>
        </div>

        <!-- Success Message (Initially Hidden) -->
        <div class="auth-card d-none" id="successMessage">
            <div class="auth-header">
                <div class="success-icon">
                    <i class="bi bi-check-lg"></i>
                </div>
                <h1 class="h3 mb-2 fw-bold">Check Your Email</h1>
                <p class="text-muted">
                    We've sent password reset instructions to
                    <strong id="emailDisplay"></strong>
                </p>
            </div>

            <div class="alert alert-info" role="alert">
                <i class="bi bi-info-circle me-2"></i>
                If you don't receive an email within 5 minutes, check your spam folder.
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-primary btn-lg" onclick="window.location.href='login.html'">
                    <i class="bi bi-arrow-left me-2"></i>
                    Back to Login
                </button>

                <button class="btn btn-outline-secondary" onclick="resetForm()">
                    Didn't receive email? Try again
                </button>
            </div>
        </div>

        <!-- Reset Password Form (For use when user clicks link from email) -->
        <div class="auth-card d-none" id="resetPasswordForm">
            <div class="auth-header">
                <div class="brand-logo">
                    <i class="bi bi-shield-lock"></i>
                </div>
                <h1 class="h3 mb-2 fw-bold">Reset Password</h1>
                <p class="text-muted">Enter your new password below</p>
            </div>

            <form id="newPasswordForm" novalidate>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">New Password</label>
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="bi bi-lock"></i>
                        </span>
                        <input type="password"
                               class="form-control"
                               id="newPassword"
                               name="newPassword"
                               placeholder="Min 8 characters"
                               required
                               minlength="8"
                               aria-label="New Password"
                               aria-describedby="newPasswordHelp">
                        <button class="btn btn-outline-secondary"
                                type="button"
                                id="toggleNewPassword"
                                aria-label="Toggle password visibility">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                    <div class="invalid-feedback">
                        Password must be at least 8 characters.
                    </div>
                    <small id="newPasswordHelp" class="form-text text-muted">
                        Use a strong password with letters, numbers, and symbols.
                    </small>
                </div>

                <div class="mb-4">
                    <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="bi bi-lock-fill"></i>
                        </span>
                        <input type="password"
                               class="form-control"
                               id="confirmNewPassword"
                               name="confirmNewPassword"
                               placeholder="Repeat password"
                               required
                               aria-label="Confirm Password">
                        <button class="btn btn-outline-secondary"
                                type="button"
                                id="toggleConfirmNewPassword"
                                aria-label="Toggle confirm password visibility">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                    <div class="invalid-feedback">
                        Passwords do not match.
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button class="btn btn-primary btn-lg" type="submit">
                        <i class="bi bi-check-lg me-2"></i>
                        Reset Password
                    </button>
                </div>

                <hr class="my-4">

                <div class="text-center">
                    <p>
                        <a href="login.html" class="text-decoration-none">
                            <i class="bi bi-arrow-left me-1"></i>
                            Back to Login
                        </a>
                    </p>
                </div>
            </form>
        </div>

        <div class="text-center mt-4">
            <p class="text-white-50 small">
                &copy; 2025 Kiaalap. All rights reserved.
                <a href="#" class="text-white-50">Privacy</a> Â·
                <a href="#" class="text-white-50">Terms</a>
            </p>
        </div>        </div>
    </main>

    {{> footer}}
</div>

{{> scripts}}

<script>
document.addEventListener('DOMContentLoaded', function() {
            // Check if there's a reset token in the URL (would come from email link)
            const urlParams = new URLSearchParams(window.location.search);
            const resetToken = urlParams.get('token');

            if (resetToken) {
                // Show reset password form if token is present
                document.getElementById('recoveryForm').classList.add('d-none');
                document.getElementById('resetPasswordForm').classList.remove('d-none');
            }

            // Handle password recovery form submission
            const recoveryForm = document.getElementById('passwordRecoveryForm');
            if (recoveryForm) {
                recoveryForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    event.stopPropagation();

                    if (recoveryForm.checkValidity()) {
                        // Get email value
                        const email = document.getElementById('email').value;

                        // Show success message
                        document.getElementById('recoveryForm').classList.add('d-none');
                        document.getElementById('successMessage').classList.remove('d-none');
                        document.getElementById('emailDisplay').textContent = email;

                        // In a real app, would send API request here
                        console.log('Password recovery email sent to:', email);
                    }

                    recoveryForm.classList.add('was-validated');
                });
            }

            // Handle new password form submission
            const newPasswordForm = document.getElementById('newPasswordForm');
            if (newPasswordForm) {
                newPasswordForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    event.stopPropagation();

                    const newPassword = document.getElementById('newPassword');
                    const confirmNewPassword = document.getElementById('confirmNewPassword');

                    // Check password match
                    if (newPassword.value !== confirmNewPassword.value) {
                        confirmNewPassword.setCustomValidity('Passwords do not match');
                    } else {
                        confirmNewPassword.setCustomValidity('');
                    }

                    if (newPasswordForm.checkValidity()) {
                        // Password reset successful
                        console.log('Password reset successful');
                        // window.location.href = 'login.html';
                    }

                    newPasswordForm.classList.add('was-validated');
                });
            }

            // Toggle password visibility functions
            const toggleNewPassword = document.getElementById('toggleNewPassword');
            const newPassword = document.getElementById('newPassword');

            if (toggleNewPassword) {
                toggleNewPassword.addEventListener('click', function() {
                    const type = newPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    newPassword.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('bi-eye');
                    this.querySelector('i').classList.toggle('bi-eye-slash');
                });
            }

            const toggleConfirmNewPassword = document.getElementById('toggleConfirmNewPassword');
            const confirmNewPassword = document.getElementById('confirmNewPassword');

            if (toggleConfirmNewPassword) {
                toggleConfirmNewPassword.addEventListener('click', function() {
                    const type = confirmNewPassword.getAttribute('type') === 'password' ? 'text' : 'password';
                    confirmNewPassword.setAttribute('type', type);
                    this.querySelector('i').classList.toggle('bi-eye');
                    this.querySelector('i').classList.toggle('bi-eye-slash');
                });
            }

            // Password match validation
            if (confirmNewPassword && newPassword) {
                confirmNewPassword.addEventListener('input', function() {
                    if (newPassword.value !== confirmNewPassword.value) {
                        confirmNewPassword.setCustomValidity('Passwords do not match');
                    } else {
                        confirmNewPassword.setCustomValidity('');
                    }
                });

                newPassword.addEventListener('input', function() {
                    if (confirmNewPassword.value && newPassword.value !== confirmNewPassword.value) {
                        confirmNewPassword.setCustomValidity('Passwords do not match');
                    } else {
                        confirmNewPassword.setCustomValidity('');
                    }
                });
            }
        });

        // Reset form function
        function resetForm() {
            document.getElementById('successMessage').classList.add('d-none');
            document.getElementById('recoveryForm').classList.remove('d-none');
            document.getElementById('passwordRecoveryForm').classList.remove('was-validated');
            document.getElementById('email').value = '';
        }
</script>